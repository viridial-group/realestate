server:
  port: 8080

spring:
  application:
    name: gateway
  main:
    allow-bean-definition-overriding: true
  cloud:
    gateway:
      routes:
        - id: identity-service
          uri: http://localhost:8081
          predicates:
            - Path=/api/identity/**
        
        - id: property-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/properties/**
        
        - id: property-service-public
          uri: http://localhost:8083
          predicates:
            - Path=/api/public/properties/**
        
        - id: advertisements-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/advertisements/**
        
        # Property service routes for organization reviews (search, reviews, etc.)
        # These routes have higher priority (order: 1) to match specific paths first
        - id: public-organizations-service-search
          uri: http://localhost:8083
          predicates:
            - Path=/api/public/organizations/search
          order: 1
        
        - id: public-organizations-service-reviews-stats
          uri: http://localhost:8083
          predicates:
            - Path=/api/public/organizations/*/reviews/stats
          order: 1
        
        - id: public-organizations-service-reviews
          uri: http://localhost:8083
          predicates:
            - Path=/api/public/organizations/*/reviews
          order: 1
        
        - id: public-organizations-service-reviews-helpful
          uri: http://localhost:8083
          predicates:
            - Path=/api/public/organizations/reviews/**
          order: 1
        
        - id: public-organizations-service-performance
          uri: http://localhost:8083
          predicates:
            - Path=/api/public/organizations/*/performance
          order: 1
        
        # Property service route for organization with reviews (by ID)
        # This route handles GET /api/public/organizations/{id} to return organization with review stats
        - id: public-organizations-service-by-id
          uri: http://localhost:8083
          predicates:
            - Path=/api/public/organizations/{id}
            - Method=GET
          order: 1
        
        # Identity service route for organization contact messages
        - id: public-organizations-identity-contact
          uri: http://localhost:8081
          predicates:
            - Path=/api/public/organizations/*/contact
            - Method=POST
          order: 1

        # Identity service route for basic organization list (exact path only, no ID)
        # This route has lower priority (default order) to match only the base path
        - id: identity-service-public-organizations
          uri: http://localhost:8081
          predicates:
            - Path=/api/public/organizations
            - Method=GET
        
        - id: contact-messages-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/contact-messages/**
        
        - id: reviews-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/reviews/**
        
        - id: price-alerts-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/price-alerts/**
        
        - id: visits-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/visits/**
        
        - id: market-data-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/market-data/**
        
        - id: dvf-admin-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/admin/dvf/**
        
        - id: resource-service
          uri: http://localhost:8084
          predicates:
            - Path=/api/resources/**
        
        - id: document-service
          uri: http://localhost:8085
          predicates:
            - Path=/api/documents/**
        
        - id: workflow-service
          uri: http://localhost:8086
          predicates:
            - Path=/api/workflows/**
        
        - id: notification-service
          uri: http://localhost:8087
          predicates:
            - Path=/api/notifications/**
        
        - id: emailing-service
          uri: http://localhost:8088
          predicates:
            - Path=/api/emails/**
        
        - id: audit-service
          uri: http://localhost:8089
          predicates:
            - Path=/api/audit/**
        
        - id: billing-service
          uri: http://localhost:8090
          predicates:
            - Path=/api/billing/**

      management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  health:
    liveness-state:
      enabled: true
    readiness-state:
      enabled: true

logging:
  level:
    root: INFO
    com.realestate: DEBUG

# CORS Configuration
cors:
  allowed-origins: http://localhost:3000,http://localhost:3001,http://localhost:3003,http://localhost:5173,http://localhost:5174
  allowed-methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
  allowed-headers: Authorization,Content-Type,X-Requested-With,Accept,Origin
  allow-credentials: true
  max-age: 3600

